<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOOD — Security Monitor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Boogaloo&family=Nunito:wght@400;600;700;800;900&family=Space+Mono:wght@400;700&family=Amatic+SC:wght@400;700&family=Caveat:wght@400;500;600;700&family=Rajdhani:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #120e0c;
            --bg-mid: #231E1A;
            --bg-warm: #2a221d;
            --paper: #d4b9a0;
            --paper-light: #e8d5c4;
            --paper-dark: #b0957c;
            --paper-shadow: #8a7660;
            --red-dark: #5a1a1a;
            --red-mid: #8a2828;
            --red-bright: #d44040;
            --green: #6aaa4a;
            --green-bright: #8acc6a;
            --yellow: #d4a040;
            --yellow-bright: #e8b850;
            --text-bright: #e8ddd0;
            --text-mid: #b8a898;
            --text-dim: #70655c;
            --text-dark: #3a2e24;
            --font-display: 'Boogaloo', cursive;
            --font-scrawl: 'Caveat', cursive;
            --font-body: 'Nunito', sans-serif;
            --font-mono: 'Space Mono', monospace;
            --font-ui: 'Rajdhani', sans-serif;
        }

        body {
            min-height: 100vh;
            background: #080808;
            background-image:
                linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.95)),
                url('background.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            margin: 0;
            overflow: hidden;
            font-family: var(--font-body);
            perspective: 1500px;
        }

        /* ─── FPS VIEW CONTAINER ─── */
        .fps-view {
            transform-style: preserve-3d;
            transform: rotateX(2deg) rotateY(0deg);
            /* Less rotation for a monitor sitting on a desk */
            filter: drop-shadow(0 50px 80px rgba(0, 0, 0, 0.95));
            position: relative;
        }

        /* MONITOR BODY */
        .device-body {
            /* Maintain 16:9 aspect ratio */
            width: 90vw;
            height: 50.625vw;
            /* 90 * 9/16 */
            max-height: 90vh;
            max-width: 160vh;
            /* 90 * 16/9 */

            background: #252528;
            border: 24px solid #1a1a1c;
            /* Thicker bezel for monitor */
            border-bottom-width: 48px;
            /* Extra thick bottom bezel */
            border-radius: 4px;
            /* Sharper corners for monitor */
            box-shadow:
                inset 0 0 0 2px #3a3a3c,
                inset 0 0 60px rgba(0, 0, 0, 0.9),
                0 0 0 4px #0a0a0c,
                0 0 100px rgba(0, 0, 0, 0.6);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='256' height='256' filter='url(%23n)' opacity='0.08'/%3E%3C/svg%3E");
        }

        /* LOGO */
        .device-logo {
            position: absolute;
            bottom: -32px;
            left: 50%;
            transform: translateX(-50%);
            font-family: var(--font-ui);
            font-size: 14px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.15);
            letter-spacing: 4px;
            text-transform: uppercase;
            pointer-events: none;
        }

        /* POWER LED */
        .power-led {
            position: absolute;
            bottom: -30px;
            right: 40px;
            width: 8px;
            height: 2px;
            background: var(--green);
            box-shadow: 0 0 4px var(--green-bright);
            opacity: 0.8;
            border-radius: 1px;
        }

        /* MONITOR STAND */
        .device-stand {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 25%;
            height: 60px;
            background: linear-gradient(to bottom, #111, #1a1a1c);
            clip-path: polygon(10% 0, 90% 0, 100% 100%, 0% 100%);
            z-index: -1;
            /* Behind screen */
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
        }

        .device-base {
            position: absolute;
            top: calc(100% + 58px);
            left: 50%;
            transform: translateX(-50%);
            width: 320px;
            height: 12px;
            background: #1a1a1c;
            border-top: 1px solid #333;
            border-radius: 4px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.8);
            z-index: -1;
        }

        /* SCREEN CONTAINER */
        .device-screen-encasing {
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.8);
        }

        /* CRT/Scanline Effects */
        .device-screen-encasing::after {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.15) 2px, rgba(0, 0, 0, 0.15) 4px), radial-gradient(circle at center, transparent 60%, rgba(0, 0, 0, 0.4) 100%);
            pointer-events: none;
            z-index: 100;
            mix-blend-mode: overlay;
        }

        .device-screen-encasing::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(115deg, transparent 40%, rgba(255, 255, 255, 0.03) 45%, rgba(255, 255, 255, 0.05) 50%, transparent 60%);
            pointer-events: none;
            z-index: 101;
        }

        /* ─── MONITOR CONTENT ─── */
        .monitor-content {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            background: #050505;
        }

        /* Header Bar */
        .monitor-header {
            height: 36px;
            background: #0f0f0f;
            border-bottom: 1px solid rgba(180, 150, 120, 0.15);
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 16px;
        }

        .header-title {
            font-family: var(--font-ui);
            font-size: 14px;
            font-weight: 700;
            color: var(--text-mid);
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-title::before {
            content: '';
            display: block;
            width: 8px;
            height: 8px;
            background: var(--yellow);
            border-radius: 50%;
            box-shadow: 0 0 6px var(--yellow-glow);
        }

        .header-info {
            margin-left: auto;
            display: flex;
            gap: 20px;
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--text-dim);
        }

        .header-hint {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--yellow);
            opacity: 0.8;
            animation: hintPulse 2s infinite ease-in-out;
            letter-spacing: 1px;
            pointer-events: none;
            white-space: nowrap;
        }

        @keyframes hintPulse {

            0%,
            100% {
                opacity: 0.4;
            }

            50% {
                opacity: 1;
                text-shadow: 0 0 8px var(--yellow-glow);
            }
        }

        /* Main View */
        .monitor-viewport {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #040404;
        }

        /* Fullscreen Camera Feed */
        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: sepia(0.2) contrast(1.1) brightness(0.8);
            opacity: 0.8;
        }

        .multifeed-view {
            position: absolute;
            inset: 0;
            display: none;
            padding: 14px;
            background:
                radial-gradient(circle at 50% 0%, rgba(80, 190, 120, 0.08), transparent 40%),
                linear-gradient(180deg, #020504 0%, #050a07 100%);
            box-shadow: inset 0 0 80px rgba(0, 0, 0, 0.9);
        }

        .multifeed-grid {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            grid-template-rows: repeat(2, minmax(0, 1fr));
            gap: 10px;
        }

        .multi-tile {
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(106, 170, 74, 0.45);
            background: #040705;
            cursor: pointer;
            transition: transform 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease;
        }

        .multi-tile:hover {
            transform: scale(1.015);
            border-color: rgba(138, 204, 106, 0.9);
            box-shadow: 0 0 12px rgba(138, 204, 106, 0.35);
            z-index: 2;
        }

        .multi-tile.static-channel {
            cursor: default;
            border-color: rgba(138, 204, 106, 0.55);
            background:
                radial-gradient(circle at 22% 28%, rgba(138, 204, 106, 0.18), transparent 36%),
                radial-gradient(circle at 75% 64%, rgba(106, 170, 74, 0.12), transparent 40%),
                linear-gradient(180deg, #07100b 0%, #050a07 100%);
        }

        .multi-tile.static-channel:hover {
            transform: none;
            box-shadow: 0 0 12px rgba(138, 204, 106, 0.2);
        }

        .multi-tile-static-grid {
            position: absolute;
            inset: 0;
            background:
                linear-gradient(to right, rgba(138, 204, 106, 0.08) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(138, 204, 106, 0.08) 1px, transparent 1px);
            background-size: 32px 32px;
            opacity: 0.8;
            pointer-events: none;
            z-index: 1;
        }

        .multi-tile img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(0.25) contrast(1.25) brightness(0.75) hue-rotate(70deg) saturate(1.1);
            opacity: 0.85;
        }

        .multi-tile::after {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.2) 2px, rgba(0, 0, 0, 0.2) 4px);
            pointer-events: none;
        }

        .multi-tile-meta {
            position: absolute;
            left: 8px;
            right: 8px;
            bottom: 8px;
            display: flex;
            justify-content: space-between;
            gap: 10px;
            font-family: var(--font-mono);
            font-size: 10px;
            color: rgba(182, 235, 168, 0.95);
            letter-spacing: 1px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);
            z-index: 2;
        }

        .static-channel-label {
            position: absolute;
            top: 10px;
            left: 10px;
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 1px;
            color: rgba(190, 240, 176, 0.95);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            z-index: 2;
        }

        .multi-feed-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 700;
            color: rgba(138, 204, 106, 0.95);
            border: 1px solid rgba(138, 204, 106, 0.5);
            background: rgba(10, 30, 14, 0.55);
            padding: 3px 8px;
            letter-spacing: 1px;
            z-index: 3;
        }

        .monitor-viewport.multi-layout .camera-feed,
        .monitor-viewport.multi-layout .camera-overlay {
            display: none;
        }

        .monitor-viewport.multi-layout .multifeed-view {
            display: block;
        }

        .monitor-viewport.multi-layout #overlay-anomaly {
            display: none !important;
        }

        /* Overlay UI on top of camera */
        .camera-overlay {
            position: absolute;
            inset: 0;
            padding: 24px;
            pointer-events: none;
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.8);
        }

        .cam-tag-tl {
            position: absolute;
            top: 24px;
            left: 24px;
            display: flex;
            flex-direction: column;
        }

        .cam-id {
            font-family: var(--font-mono);
            font-size: 24px;
            font-weight: 700;
            color: var(--text-bright);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .cam-loc {
            font-family: var(--font-display);
            font-size: 32px;
            color: var(--yellow);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
            margin-top: -4px;
        }

        .cam-tag-tr {
            position: absolute;
            top: 24px;
            right: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rec-badge {
            background: rgba(212, 64, 64, 0.2);
            border: 1px solid var(--red-bright);
            color: var(--red-bright);
            padding: 4px 12px;
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 700;
            border-radius: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: pulse-red 2s infinite;
        }

        .rec-dot {
            width: 8px;
            height: 8px;
            background: var(--red-bright);
            border-radius: 50%;
        }

        @keyframes pulse-red {

            0%,
            100% {
                box-shadow: 0 0 4px rgba(212, 64, 64, 0.2);
                opacity: 1;
            }

            50% {
                box-shadow: 0 0 12px rgba(212, 64, 64, 0.6);
                opacity: 0.7;
            }
        }

        .cam-tag-bl {
            position: absolute;
            bottom: 24px;
            left: 24px;
            font-family: var(--font-mono);
            font-size: 14px;
            color: var(--text-dim);
            letter-spacing: 1px;
            display: flex;
            gap: 20px;
        }

        .footer-pay {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 15px;
            border-left: 1px solid rgba(255, 255, 255, 0.05);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            margin: 0 10px;
            min-width: 100px;
            position: relative;
        }

        .footer-pay-label {
            font-family: var(--font-ui);
            font-size: 9px;
            font-weight: 800;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            line-height: 1;
            margin-bottom: 2px;
        }

        .footer-pay-value {
            font-family: var(--font-display);
            font-size: 24px;
            color: var(--green-bright);
            text-shadow: 0 0 10px rgba(106, 170, 74, 0.3);
            line-height: 1;
        }

        .pay-float {
            position: absolute;
            top: -10px;
            font-family: var(--font-display);
            font-size: 18px;
            font-weight: 700;
            pointer-events: none;
            animation: payFloatUp 1.2s ease-out forwards;
            white-space: nowrap;
            z-index: 100;
        }

        .pay-float.plus {
            color: var(--green-bright);
            text-shadow: 0 0 10px rgba(106, 170, 74, 0.5);
        }

        .pay-float.minus {
            color: var(--red-bright);
            text-shadow: 0 0 10px rgba(212, 64, 64, 0.5);
        }

        @keyframes payFloatUp {
            0% {
                transform: translateY(0);
                opacity: 0;
            }

            20% {
                opacity: 1;
            }

            100% {
                transform: translateY(-40px);
                opacity: 0;
            }
        }

        /* ─── FOOTER CONTROLS ─── */
        .monitor-footer {
            height: 64px;
            background: #111;
            border-top: 1px solid rgba(180, 150, 120, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 0 20px;
            position: relative;
        }

        /* Consistent Button Styles */
        .btn {
            font-family: var(--font-display);
            font-size: 18px;
            padding: 8px 20px;
            border: 2px solid rgba(180, 150, 120, 0.2);
            border-bottom: 3px solid rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.2, 0.8, 0.2, 1);
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: 0.5px;
            background: linear-gradient(to bottom, var(--bg-mid), #231e1a);
            color: var(--text-mid);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            text-shadow: 0 2px 2px rgba(0, 0, 0, 0.5);
            border-radius: 3px;
            min-width: 140px;
            justify-content: center;
        }

        .btn:hover {
            transform: scale(1.03) rotate(-0.5deg);
            background: linear-gradient(to bottom, var(--paper), #cbb094);
            color: var(--bg-dark);
            border-color: var(--paper);
            text-shadow: none;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
            z-index: 5;
        }

        .btn:active {
            transform: scale(0.98);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border-bottom-width: 2px;
        }

        .btn.active {
            background: var(--paper);
            color: var(--bg-dark);
            border-color: var(--paper-dark);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
            transform: translateY(2px);
            border-bottom-width: 1px;
            pointer-events: none;
        }

        .btn-layout {
            min-width: 128px;
            border-color: rgba(106, 170, 74, 0.3);
            color: rgba(156, 209, 135, 0.9);
            background: linear-gradient(to bottom, #172117, #101710);
            text-shadow: 0 0 8px rgba(106, 170, 74, 0.2);
        }

        .btn-layout:hover {
            background: linear-gradient(to bottom, #203020, #172217);
            color: #c8efbb;
            border-color: rgba(138, 204, 106, 0.7);
            text-shadow: 0 0 10px rgba(138, 204, 106, 0.45);
        }

        .btn-layout.layout-active {
            background: linear-gradient(to bottom, #2a4026, #1c2b1a);
            color: #d8f5ce;
            border-color: rgba(138, 204, 106, 0.9);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.35), 0 0 14px rgba(138, 204, 106, 0.25);
        }

        /* CRT Scanline Animation */
        @keyframes scanline {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(100%);
            }
        }

        .scan-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent 50%, rgba(0, 0, 0, 0.1) 51%, transparent 51%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 50;
        }

        .scan-beam {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 20%;
            background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.05), transparent);
            animation: scanline 6s linear infinite;
            pointer-events: none;
            z-index: 51;
        }

        /* ─── TOOLS / INVENTORY ─── */

        /* ─── STRESS MONITOR ─── */
        .stress-monitor {
            position: absolute;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(to bottom, #1a1613, #110e0c);
            border: 1px solid rgba(180, 150, 120, 0.15);
            padding: 6px 14px;
            border-radius: 4px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.4), 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        .stress-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--green-bright);
            animation: heartbeat 1.5s infinite;
            transition: color 0.3s;
        }

        @keyframes heartbeat {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.8;
            }

            10% {
                transform: scale(1.15);
                opacity: 1;
                filter: drop-shadow(0 0 4px currentColor);
            }

            20% {
                transform: scale(1);
                opacity: 0.8;
            }

            30% {
                transform: scale(1.15);
                opacity: 1;
                filter: drop-shadow(0 0 4px currentColor);
            }

            40% {
                transform: scale(1);
                opacity: 0.8;
            }
        }

        .stress-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            justify-content: center;
        }

        .stress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100px;
            margin-bottom: 2px;
        }

        .stress-label {
            font-family: var(--font-ui);
            font-size: 10px;
            font-weight: 700;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            line-height: 1;
        }

        .stress-value {
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 800;
            color: var(--green-bright);
            line-height: 1;
            transition: color 0.3s;
        }

        .stress-track {
            width: 100px;
            height: 6px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(180, 150, 120, 0.1);
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        .stress-fill {
            height: 100%;
            width: 35%;
            background: linear-gradient(90deg, var(--green-bright) 0%, var(--yellow) 50%, var(--red-bright) 100%);
            background-size: 100px 100%;
            box-shadow: 0 0 8px rgba(212, 160, 64, 0.4);
            transition: width 0.3s ease-out;
        }

        .stress-monitor.high-stress {
            animation: stressShake 0.5s infinite;
            border-color: rgba(212, 64, 64, 0.5);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.4), 0 0 12px rgba(212, 64, 64, 0.3);
        }

        @keyframes stressShake {

            0%,
            100% {
                transform: translate(0, 0);
            }

            25% {
                transform: translate(1px, -1px);
            }

            50% {
                transform: translate(-1px, 1px);
            }

            75% {
                transform: translate(-1px, -1px);
            }
        }

        .pills-action {
            position: absolute;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(to bottom, #231E1A, #15120f);
            border: 2px solid rgba(106, 170, 74, 0.4);
            border-bottom: 3px solid rgba(0, 0, 0, 0.4);
            padding: 6px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.2, 0.8, 0.2, 1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        .pills-action:hover {
            transform: scale(1.03) rotate(1deg);
            border-color: var(--green-bright);
            box-shadow: 0 8px 16px rgba(106, 170, 74, 0.2);
            background: linear-gradient(to bottom, #2c2520, #1a1613);
        }

        .pills-action:active {
            transform: scale(0.98);
            border-bottom-width: 2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .pill-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--green-bright);
            filter: drop-shadow(0 0 4px rgba(106, 170, 74, 0.5));
        }

        .pill-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .pill-label {
            font-family: var(--font-ui);
            font-size: 10px;
            color: var(--green-bright);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 2px;
        }

        .pill-count {
            font-family: var(--font-display);
            font-size: 20px;
            color: var(--text-bright);
            line-height: 1;
            text-shadow: 0 2px 2px rgba(0, 0, 0, 0.6);
        }

        .pill-hotkey {
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 800;
            color: #111;
            background: var(--text-mid);
            padding: 2px 6px;
            border-radius: 2px;
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.5);
            margin-left: 4px;
        }

        /* Glitch Effect for clearing hallucinations */
        @keyframes hallucinationWipe {
            0% {
                filter: contrast(1.1) brightness(0.8) hue-rotate(0deg);
                opacity: 0.8;
            }

            10% {
                filter: contrast(2.5) brightness(1.5) hue-rotate(90deg) invert(0.2);
                opacity: 1;
                transform: translate(10px, -10px) scale(1.05);
            }

            20% {
                filter: contrast(1.5) brightness(0.6) hue-rotate(-90deg);
                opacity: 0.6;
                transform: translate(-10px, 10px) scale(0.95);
            }

            30% {
                filter: contrast(2) brightness(1.2) hue-rotate(45deg);
                opacity: 0.9;
                transform: translate(5px, 5px) scale(1.02);
            }

            40% {
                filter: contrast(1.1) brightness(0.8) hue-rotate(0deg);
                opacity: 0.8;
                transform: translate(0) scale(1);
            }

            100% {
                filter: contrast(1.1) brightness(0.8);
                opacity: 0.8;
            }
        }

        .hallucination-cleared {
            animation: hallucinationWipe 0.4s cubic-bezier(0.1, 0.8, 0.1, 1);
        }

        /* Glitch Effect for Anomaly Reports */
        @keyframes reportGlitch {
            0% {
                transform: translate(0) scale(1) skewX(0);
                filter: hue-rotate(0deg) contrast(1.1) brightness(0.8) grayscale(0);
            }

            10% {
                transform: translate(-10px, 5px) scale(1.05) skewX(5deg);
                filter: hue-rotate(45deg) contrast(2) brightness(2) invert(0.2);
            }

            20% {
                transform: translate(10px, -5px) scale(0.95) skewX(-5deg);
                filter: hue-rotate(-45deg) contrast(0.8) brightness(0.5);
            }

            30% {
                transform: translate(-5px, -5px) scale(1.02);
                filter: hue-rotate(90deg) contrast(2) brightness(1.5) sepia(1);
            }

            40% {
                transform: translate(5px, 5px) scale(1.01);
                filter: hue-rotate(-90deg) contrast(1.2) brightness(0.7);
            }

            50% {
                transform: translate(0) scale(1) skewX(0);
                filter: hue-rotate(0deg) contrast(1.1) brightness(0.8);
            }
        }

        .report-glitch-active {
            animation: reportGlitch 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) 2;
        }

        /* ─── DESKTOP SYSTEM ─── */
        .desktop-view {
            position: absolute;
            inset: 0;
            background: #1a1e2a;
            background-image:
                radial-gradient(circle at 50% 50%, rgba(40, 50, 80, 0.5) 0%, transparent 100%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='256' height='256' filter='url(%23n)' opacity='0.05'/%3E%3C/svg%3E");
            display: flex;
            flex-direction: column;
            z-index: 5;
        }

        .desktop-icons {
            flex: 1;
            padding: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fill, 90px);
            grid-template-rows: repeat(auto-fill, 100px);
            gap: 20px;
            align-content: flex-start;
        }

        .desktop-shortcut {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.15s;
            user-select: none;
        }

        .desktop-shortcut:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .desktop-shortcut.active {
            background: rgba(180, 150, 120, 0.2);
            outline: 1px dotted rgba(180, 150, 120, 0.5);
        }

        .shortcut-icon {
            width: 48px;
            height: 48px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
            transition: transform 0.1s;
        }

        .desktop-shortcut:active .shortcut-icon {
            transform: scale(0.9);
        }

        .shortcut-label {
            font-family: var(--font-ui);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-bright);
            text-align: center;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
            letter-spacing: 0.5px;
            width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Taskbar */
        .taskbar {
            height: 40px;
            background: #0c0c0e;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            padding: 0 4px;
            z-index: 100;
        }

        .start-btn {
            height: 32px;
            padding: 0 16px;
            background: var(--bg-mid);
            border: 1px solid rgba(180, 150, 120, 0.2);
            color: var(--paper);
            font-family: var(--font-display);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            margin-right: 8px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .start-btn:hover {
            background: var(--bg-warm);
            border-color: var(--yellow);
        }

        .taskbar-items {
            display: flex;
            gap: 4px;
            flex: 1;
        }

        .task-item {
            height: 32px;
            min-width: 140px;
            background: rgba(40, 45, 60, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-mid);
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 8px;
            font-family: var(--font-ui);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
        }

        .task-item.active {
            background: var(--bg-mid);
            border-color: var(--yellow);
            color: var(--text-bright);
        }

        .task-item-icon {
            width: 16px;
            height: 16px;
            opacity: 0.8;
        }

        /* ─── START MENU ─── */
        .start-menu {
            position: absolute;
            bottom: 40px;
            left: 4px;
            width: 200px;
            background: #1a1e22;
            border: 2px solid var(--text-dim);
            box-shadow: 10px 10px 30px rgba(0, 0, 0, 0.8);
            z-index: 500;
            display: none;
            flex-direction: column;
            animation: startMenuPop 0.2s ease-out;
        }

        .start-menu.active {
            display: flex;
        }

        @keyframes startMenuPop {
            from {
                transform: translateY(10px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .start-menu-header {
            padding: 12px;
            background: var(--text-dim);
            color: var(--bg-dark);
            font-family: var(--font-ui);
            font-size: 13px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .start-menu-item {
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-mid);
            font-family: var(--font-ui);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.1s;
        }

        .start-menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-bright);
        }

        .start-menu-item.logout {
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(212, 64, 64, 0.1);
            color: var(--red-bright);
            font-weight: 700;
        }

        .start-menu-item.logout:hover {
            background: var(--red-mid);
            color: white;
        }

        .system-tray {
            margin-left: auto;
            padding: 0 12px;
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-dim);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* ─── MANAGEMENT APP STYLES ─── */
        .management-layout {
            display: flex;
            flex-direction: column;
            flex: 1;
            height: 100%;
            background: #0a0c0e;
            padding: 20px;
            gap: 20px;
            overflow-y: auto;
        }

        .mgmt-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .mgmt-card {
            background: #161a1e;
            border: 1px solid rgba(184, 168, 152, 0.2);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .mgmt-card-title {
            font-family: var(--font-ui);
            font-size: 11px;
            font-weight: 700;
            color: var(--text-mid);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .mgmt-value {
            font-family: var(--font-display);
            font-size: 32px;
            color: var(--text-bright);
        }

        .mgmt-value.money {
            color: var(--green-bright);
            text-shadow: 0 0 10px var(--green-glow);
        }

        .mgmt-value.warn {
            color: var(--yellow);
        }

        .mgmt-value.danger {
            color: var(--red-bright);
        }

        .mgmt-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .mgmt-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(184, 168, 152, 0.1);
            border-left: 3px solid var(--text-dim);
            font-family: var(--font-ui);
            font-size: 13px;
        }

        .mgmt-list-item.breakdown {
            border-left-color: var(--red-bright);
        }

        .mgmt-status-tag {
            font-size: 10px;
            padding: 2px 6px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--text-dim);
            color: var(--text-mid);
            text-transform: uppercase;
        }

        .mgmt-status-tag.active {
            border-color: var(--red-bright);
            color: var(--red-bright);
            animation: textPulse 1s infinite;
        }

        @keyframes textPulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        /* ─── INBOX APP STYLES ─── */
        .inbox-layout {
            display: flex;
            flex: 1;
            height: 100%;
            background: #08080a;
            overflow: hidden;
        }

        .inbox-sidebar {
            width: 160px;
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            background: rgba(255, 255, 255, 0.02);
            overflow-y: auto;
        }

        .inbox-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #050507;
            padding: 24px;
            overflow-y: auto;
        }

        .msg-item {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            cursor: pointer;
            transition: all 0.1s;
        }

        .msg-item:hover {
            background: rgba(184, 168, 152, 0.05);
        }

        .msg-item.active {
            background: rgba(212, 160, 64, 0.1);
            border-left: 3px solid var(--yellow);
        }

        .msg-item.unread .msg-subject {
            color: var(--text-bright);
            font-weight: 700;
        }

        .msg-sender {
            font-family: var(--font-ui);
            font-size: 10px;
            color: var(--yellow);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .msg-subject {
            font-family: var(--font-body);
            font-size: 12px;
            color: var(--text-mid);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .email-view-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 16px;
            margin-bottom: 24px;
        }

        .email-subject {
            font-family: var(--font-display);
            font-size: 24px;
            color: var(--text-bright);
            margin-bottom: 8px;
        }

        .email-meta {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-dim);
            display: flex;
            justify-content: space-between;
        }

        .email-body {
            font-family: var(--font-body);
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-mid);
            white-space: pre-wrap;
        }

        /* ─── APP WINDOW ─── */
        .app-window {
            position: absolute;
            inset: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            z-index: 10;
        }

        .app-header-bar {
            height: 32px;
            background: linear-gradient(to bottom, #2a2a2e, #1a1a1c);
            border-bottom: 2px solid #000;
            display: flex;
            align-items: center;
            padding: 0 8px;
            gap: 8px;
            user-select: none;
        }

        .app-title {
            font-family: var(--font-ui);
            font-size: 12px;
            font-weight: 700;
            color: var(--text-mid);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .app-controls {
            display: flex;
            gap: 4px;
        }

        .control-btn {
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.1s;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-bright);
        }

        .control-btn.close:hover {
            background: var(--red-mid);
            color: white;
            border-color: var(--red-bright);
        }

        .logs-container {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            overflow-y: auto;
            background: #0a0a0c;
            flex: 1;
        }

        .log-entry {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px;
            background: rgba(180, 150, 120, 0.03);
            border-left: 2px solid var(--text-dim);
            animation: slideInLeft 0.3s ease-out;
        }

        .log-entry.resolved {
            border-left-color: var(--green);
            background: rgba(106, 170, 74, 0.05);
        }

        .log-entry.rejected {
            border-left-color: var(--red-bright);
            background: rgba(212, 64, 64, 0.05);
        }

        .log-time {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--yellow);
            opacity: 0.8;
            white-space: nowrap;
        }

        .log-content {
            flex: 1;
        }

        .log-header {
            font-family: var(--font-ui);
            font-size: 13px;
            font-weight: 700;
            color: var(--text-bright);
            margin-bottom: 2px;
            display: flex;
            justify-content: space-between;
        }

        .log-desc {
            font-family: var(--font-body);
            font-size: 12px;
            color: var(--text-dim);
        }

        .log-status {
            font-family: var(--font-mono);
            font-size: 9px;
            text-transform: uppercase;
            padding: 2px 6px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.05);
        }

        .log-status.fixed {
            color: var(--green-bright);
        }

        .log-status.rejected {
            color: var(--red-bright);
        }

        @keyframes slideInLeft {
            from {
                transform: translateX(-10px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ═══ REPORT CONFIRMATION ANIMATIONS ═══ */
        @keyframes reportFadeIn {
            from {
                opacity: 0;
                transform: scale(0.92);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes checkDraw {
            to {
                stroke-dashoffset: 0;
            }
        }

        @keyframes ringDraw {
            to {
                stroke-dashoffset: 0;
            }
        }

        @keyframes confirmGlow {

            0%,
            100% {
                filter: drop-shadow(0 0 4px rgba(138, 204, 106, 0.3));
            }

            50% {
                filter: drop-shadow(0 0 12px rgba(138, 204, 106, 0.7));
            }
        }

        @keyframes scanConfirm {
            from {
                top: 0;
                opacity: 0.6;
            }

            to {
                top: 100%;
                opacity: 0;
            }
        }

        @keyframes barFill {
            from {
                width: 100%;
            }

            to {
                width: 0%;
            }
        }

        @keyframes textReveal {
            from {
                opacity: 0;
                transform: translateY(6px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .report-confirm {
            padding: 28px 20px 18px;
            text-align: center;
            animation: reportFadeIn 0.35s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative;
            overflow: hidden;
        }

        .report-confirm .scan-flash {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--green-bright), transparent);
            animation: scanConfirm 0.6s ease-out 0.2s forwards;
            pointer-events: none;
        }

        .confirm-icon {
            width: 52px;
            height: 52px;
            margin: 0 auto 14px;
            animation: confirmGlow 1.4s ease-in-out infinite;
        }

        .confirm-icon .ring {
            stroke-dasharray: 157;
            stroke-dashoffset: 157;
            animation: ringDraw 0.5s ease-out 0.1s forwards;
        }

        .confirm-icon .check {
            stroke-dasharray: 24;
            stroke-dashoffset: 24;
            animation: checkDraw 0.3s ease-out 0.45s forwards;
        }

        .confirm-title {
            font-family: var(--font-display);
            font-size: 20px;
            color: var(--green-bright);
            letter-spacing: 2px;
            margin-bottom: 4px;
            animation: textReveal 0.3s ease-out 0.25s both;
        }

        .confirm-id {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--yellow);
            opacity: 0.85;
            margin-bottom: 4px;
            animation: textReveal 0.3s ease-out 0.4s both;
        }

        .confirm-sub {
            font-family: var(--font-ui);
            font-size: 12px;
            color: var(--text-dim);
            animation: textReveal 0.3s ease-out 0.55s both;
        }

        .confirm-bar-track {
            margin-top: 16px;
            height: 2px;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 1px;
            overflow: hidden;
            animation: textReveal 0.2s ease-out 0.6s both;
        }

        .confirm-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green), var(--green-bright));
            border-radius: 1px;
            animation: barFill 4.3s linear 0.65s forwards;
        }

        /* ═══ FAILED REPORT ANIMATIONS ═══ */
        @keyframes failGlow {

            0%,
            100% {
                filter: drop-shadow(0 0 4px rgba(212, 64, 64, 0.3));
            }

            50% {
                filter: drop-shadow(0 0 12px rgba(212, 64, 64, 0.7));
            }
        }

        @keyframes crossDraw {
            to {
                stroke-dashoffset: 0;
            }
        }

        .report-fail {
            padding: 28px 20px 18px;
            text-align: center;
            animation: reportFadeIn 0.35s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative;
            overflow: hidden;
        }

        .report-fail .scan-flash {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--red-bright), transparent);
            animation: scanConfirm 0.6s ease-out 0.2s forwards;
            pointer-events: none;
        }

        .fail-icon {
            width: 52px;
            height: 52px;
            margin: 0 auto 14px;
            animation: failGlow 1.4s ease-in-out infinite;
        }

        .fail-icon .ring {
            stroke-dasharray: 157;
            stroke-dashoffset: 157;
            animation: ringDraw 0.5s ease-out 0.1s forwards;
            stroke: var(--red-bright);
        }

        .fail-icon .cross {
            stroke-dasharray: 30;
            stroke-dashoffset: 30;
            animation: crossDraw 0.3s ease-out 0.45s forwards;
            stroke: var(--red-bright);
        }

        .fail-title {
            font-family: var(--font-display);
            font-size: 20px;
            color: var(--red-bright);
            letter-spacing: 2px;
            margin-bottom: 4px;
            animation: textReveal 0.3s ease-out 0.25s both;
        }

        .fail-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--red-dark), var(--red-bright));
            border-radius: 1px;
            animation: barFill 4.3s linear 0.65s forwards;
        }

        /* ═══ OVERLAY SYSTEM ═══ */
        .overlay {
            position: absolute;
            inset: 0;
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(12, 10, 8, 0.6);
            backdrop-filter: blur(2px);
            animation: overlayIn 0.25s ease-out;
        }

        .overlay.active {
            display: flex;
        }

        @keyframes overlayIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .overlay-close-hint {
            position: absolute;
            top: 18px;
            right: 24px;
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-dim);
            letter-spacing: 1px;
            opacity: 0.6;
        }

        /* ─── ANOMALY REPORT CONTEXT MENU ─── */
        #overlay-anomaly {
            background: none;
            backdrop-filter: none;
        }

        .context-menu {
            position: absolute;
            /* Allow manual positioning */
            width: 252px;
            background: linear-gradient(to bottom, #1a1613, #110e0c);
            border: 1px solid rgba(180, 150, 120, 0.22);
            border-bottom: 2px solid rgba(0, 0, 0, 0.55);
            border-radius: 4px;
            overflow: hidden;
            box-shadow: inset 0 0 22px rgba(0, 0, 0, 0.55), 0 14px 30px rgba(0, 0, 0, 0.65);
            backdrop-filter: blur(2px);
            animation: modalPop 0.35s ease-out;
        }

        .context-menu::after {
            content: '';
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.08) 2px, rgba(0, 0, 0, 0.08) 4px);
            opacity: 0.6;
        }

        @keyframes modalPop {
            from {
                transform: scale(0.92) translateY(12px);
                opacity: 0;
            }

            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .context-header {
            padding: 9px 12px;
            border-bottom: 1px solid rgba(180, 150, 120, 0.14);
            background: linear-gradient(to right, rgba(106, 170, 74, 0.1), rgba(212, 160, 64, 0.06));
            position: relative;
            z-index: 1;
        }

        .context-header-text {
            font-family: var(--font-ui);
            font-size: 11px;
            font-weight: 800;
            color: var(--text-mid);
            letter-spacing: 1.6px;
            text-transform: uppercase;
        }

        .context-item {
            padding: 9px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background 0.12s cubic-bezier(0.2, 0.8, 0.2, 1), transform 0.12s cubic-bezier(0.2, 0.8, 0.2, 1), border-color 0.12s;
            border-bottom: 1px solid rgba(180, 150, 120, 0.08);
            border-left: 2px solid transparent;
            background: transparent;
            position: relative;
            z-index: 1;
        }

        .context-item:last-child {
            border-bottom: none;
        }

        .context-item:hover {
            background: linear-gradient(to right, rgba(106, 170, 74, 0.14), rgba(106, 170, 74, 0.02));
            border-left-color: rgba(138, 204, 106, 0.85);
            transform: translateX(2px);
        }

        .context-item:active {
            background: linear-gradient(to right, rgba(106, 170, 74, 0.22), rgba(106, 170, 74, 0.04));
            transform: scale(0.99);
        }

        .context-item:hover .ctx-label,
        .context-item:hover .ctx-icon {
            color: #c8efbb;
        }

        .ctx-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            color: var(--text-dim);
            transition: color 0.12s;
        }

        .ctx-icon svg {
            display: block;
            width: 100%;
            height: 100%;
            stroke: currentColor;
            fill: none;
            stroke-width: 1.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .ctx-icon svg .fill-current {
            fill: currentColor;
            stroke: none;
        }

        .ctx-label {
            font-family: var(--font-ui);
            font-size: 12px;
            font-weight: 700;
            color: var(--text-mid);
            flex: 1;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: color 0.12s;
        }

        .ctx-key {
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 800;
            color: var(--paper-light);
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(180, 150, 120, 0.3);
            border-bottom: 2px solid rgba(0, 0, 0, 0.35);
            background: linear-gradient(to bottom, #2a2520, #1a1613);
            text-shadow: 0 1px 0 rgba(0, 0, 0, 0.4);
            border-radius: 3px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05), 0 2px 4px rgba(0, 0, 0, 0.25);
        }

        .context-item:hover .ctx-key {
            color: #d8f5ce;
            border-color: rgba(138, 204, 106, 0.55);
            background: linear-gradient(to bottom, #22331e, #162114);
        }

        /* ─── VOICE INDICATOR ─── */
        .voice-indicator {
            position: fixed;
            bottom: 32px;
            left: 32px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 14px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(180, 150, 120, 0.2);
            border-radius: 4px;
            backdrop-filter: blur(4px);
            z-index: 9999;
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .voice-indicator.speaking {
            opacity: 1;
            transform: translateX(0);
        }

        .voice-indicator.radio {
            border-color: rgba(106, 170, 74, 0.4);
            background: rgba(106, 170, 74, 0.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), inset 0 0 12px rgba(106, 170, 74, 0.1);
        }

        .voice-indicator.radio .voice-label {
            color: var(--green-bright);
            text-shadow: 0 0 8px rgba(106, 170, 74, 0.4);
        }

        .voice-indicator.radio .wave {
            background: var(--green-bright);
            box-shadow: 0 0 6px var(--green-bright);
        }

        .voice-indicator.local {
            border-color: rgba(212, 160, 64, 0.4);
            background: rgba(212, 160, 64, 0.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), inset 0 0 12px rgba(212, 160, 64, 0.1);
        }

        .voice-indicator.local .voice-label {
            color: var(--yellow-bright);
            text-shadow: 0 0 8px rgba(212, 160, 64, 0.4);
        }

        .voice-indicator.local .wave {
            background: var(--yellow-bright);
            box-shadow: 0 0 6px var(--yellow-bright);
        }

        .voice-icon {
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .voice-icon svg {
            width: 100%;
            height: 100%;
            stroke: currentColor;
        }

        .voice-indicator.radio .voice-icon {
            color: var(--green-bright);
            filter: drop-shadow(0 0 4px var(--green-bright));
        }

        .voice-indicator.local .voice-icon {
            color: var(--yellow-bright);
            filter: drop-shadow(0 0 4px var(--yellow-bright));
        }

        .voice-waves {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 14px;
        }

        .wave {
            width: 3px;
            height: 4px;
            border-radius: 1.5px;
            animation: soundWave 0.2s alternate infinite;
        }

        .wave:nth-child(1) {
            animation-duration: 0.15s;
        }

        .wave:nth-child(2) {
            animation-duration: 0.25s;
            animation-delay: 0.05s;
        }

        .wave:nth-child(3) {
            animation-duration: 0.18s;
            animation-delay: 0.1s;
        }

        .wave:nth-child(4) {
            animation-duration: 0.22s;
            animation-delay: 0.15s;
        }

        @keyframes soundWave {
            0% {
                height: 4px;
            }

            100% {
                height: 14px;
            }
        }

        .voice-label {
            font-family: var(--font-ui);
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-left: 2px;
        }

        /* ─── SYSTEM DIALOG ─── */
        #system-dialog {
            position: absolute;
            inset: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
        }

        .dialog-box {
            width: 320px;
            background: #1a1e22;
            border: 2px solid var(--text-dim);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
            animation: dialogPop 0.25s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        .dialog-box::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.02), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.02));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
        }

        .dialog-header {
            background: var(--text-dim);
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dialog-title {
            font-family: var(--font-ui);
            font-size: 12px;
            font-weight: 800;
            color: var(--bg-dark);
            text-transform: uppercase;
            letter-spacing: 1px;
            flex: 1;
        }

        .dialog-body {
            padding: 24px 20px;
            text-align: center;
            background: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));
        }

        .dialog-msg {
            font-family: var(--font-body);
            font-size: 14px;
            color: var(--text-mid);
            line-height: 1.5;
        }

        .dialog-footer {
            padding: 12px;
            display: flex;
            justify-content: center;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .dialog-btn {
            padding: 6px 24px;
            background: var(--bg-warm);
            border: 1px solid var(--text-dim);
            color: var(--text-mid);
            font-family: var(--font-ui);
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.1s;
        }

        .dialog-btn:hover {
            background: var(--text-dim);
            color: var(--bg-dark);
        }

        @keyframes dialogPop {
            from {
                transform: scale(0.9);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="fps-view">
        <div class="device-body">
            <!-- Logo & LED -->
            <div class="device-logo">WOOD SYS</div>
            <div class="power-led"></div>

            <!-- Stand -->
            <div class="device-stand"></div>
            <div class="device-base"></div>

            <div class="device-screen-encasing">
                <div class="scan-overlay"></div>
                <div class="scan-beam"></div>

                <div class="monitor-content">
                    <!-- ─── DESKTOP VIEW ─── -->
                    <div class="desktop-view" id="desktop-view">
                        <div class="desktop-icons">
                            <!-- Security Shortcut -->
                            <div class="desktop-shortcut" id="shortcut-security" ondblclick="openApp('security')">
                                <div class="shortcut-icon">
                                    <svg viewBox="0 0 48 48" fill="none">
                                        <rect x="4" y="8" width="40" height="32" rx="2" stroke="var(--yellow)"
                                            stroke-width="2" fill="rgba(212, 160, 64, 0.1)" />
                                        <circle cx="24" cy="24" r="8" stroke="var(--yellow)" stroke-width="2" />
                                        <path d="M24 16v16M16 24h16" stroke="var(--yellow)" stroke-width="2"
                                            stroke-linecap="round" opacity="0.5" />
                                        <circle cx="24" cy="24" r="2" fill="var(--yellow)" />
                                    </svg>
                                </div>
                                <span class="shortcut-label">Security.exe</span>
                            </div>

                            <!-- Mails Shortcut -->
                            <div class="desktop-shortcut" id="shortcut-mails" ondblclick="openApp('inbox')">
                                <div class="shortcut-icon">
                                    <svg viewBox="0 0 48 48" fill="none">
                                        <rect x="6" y="12" width="36" height="24" rx="2" stroke="var(--text-mid)"
                                            stroke-width="2" />
                                        <path d="M6 14l18 12 18-12" stroke="var(--text-mid)" stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="shortcut-label">Inbox</span>
                            </div>

                            <!-- Records Shortcut -->
                            <div class="desktop-shortcut" id="shortcut-records" ondblclick="openApp('logs')">
                                <div class="shortcut-icon">
                                    <svg viewBox="0 0 48 48" fill="none">
                                        <path d="M10 10v28h28V14L32 8H10z" stroke="var(--text-mid)" stroke-width="2" />
                                        <rect x="16" y="16" width="16" height="2" fill="var(--text-mid)" />
                                        <rect x="16" y="22" width="16" height="2" fill="var(--text-mid)" />
                                        <rect x="16" y="28" width="10" height="2" fill="var(--text-mid)" />
                                    </svg>
                                </div>
                                <span class="shortcut-label">Incident_Logs</span>
                            </div>

                            <!-- Trash Shortcut -->
                            <div class="desktop-shortcut" id="shortcut-trash"
                                ondblclick="showSystemDialog('Recycle Bin', 'Trash is empty. No deleted logs found.')">
                                <div class="shortcut-icon">
                                    <svg viewBox="0 0 48 48" fill="none">
                                        <path d="M12 10h24v30a2 2 0 01-2 2H14a2 2 0 01-2-2V10z" stroke="var(--text-dim)"
                                            stroke-width="2" />
                                        <path d="M8 10h32M18 4h12" stroke="var(--text-dim)" stroke-width="2" />
                                        <line x1="20" y1="18" x2="20" y2="34" stroke="var(--text-dim)"
                                            stroke-width="2" />
                                        <line x1="28" y1="18" x2="28" y2="34" stroke="var(--text-dim)"
                                            stroke-width="2" />
                                    </svg>
                                </div>
                                <span class="shortcut-label">Recycle Bin</span>
                            </div>

                        </div>

                        <!-- Manager Shortcut (Relocated to top-right) -->
                        <div class="desktop-shortcut" id="shortcut-manager" ondblclick="openApp('manager')"
                            style="position: absolute; top: 24px; right: 24px;">
                            <div class="shortcut-icon">
                                <svg viewBox="0 0 48 48" fill="none">
                                    <rect x="8" y="12" width="32" height="24" rx="2" stroke="var(--green)"
                                        stroke-width="2" fill="rgba(106, 170, 74, 0.1)" />
                                    <path d="M16 20h16M16 26h10M16 32h16" stroke="var(--green)" stroke-width="2"
                                        stroke-linecap="round" />
                                    <circle cx="34" cy="26" r="4" stroke="var(--green)" stroke-width="2" />
                                </svg>
                            </div>
                            <span class="shortcut-label">Management.sys</span>
                        </div>

                        <!-- Taskbar -->
                        <div class="taskbar">
                            <div class="start-btn" onclick="toggleStartMenu(event)">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
                                </svg>
                                <span>WOOD</span>
                            </div>
                            <div class="taskbar-items" id="taskbar-items">
                                <!-- Running apps show up here -->
                            </div>
                            <div class="system-tray">
                                <span style="color:var(--green)">Online</span>
                                <span id="taskbar-clock">00:00</span>
                            </div>
                        </div>

                        <!-- ─── START MENU POPUP ─── -->
                        <div class="start-menu" id="start-menu">
                            <div class="start-menu-header">WOOD SYSTEMS v2.4</div>
                            <div class="start-menu-item"
                                onclick="showSystemDialog('Access Denied', 'User settings are currently locked by the System Administrator. Please contact your supervisor for access.')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z" />
                                </svg>
                                User Settings
                            </div>
                            <div class="start-menu-item"
                                onclick="showSystemDialog('Security Alert', 'System Configuration is restricted to Level 4 Personnel only. Your current clearance: Level 1 (Observer).')">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="3" />
                                    <path
                                        d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" />
                                </svg>
                                System Config
                            </div>
                            <div class="start-menu-item logout" onclick="logout()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 01-2-2h4M16 17l5-5-5-5M21 12H9" />
                                </svg>
                                Stand Up (Logout)
                            </div>
                        </div>
                    </div>

                    <!-- ─── SECURITY APP WINDOW ─── -->
                    <div class="app-window" id="security-app" style="display:none">
                        <div class="app-header-bar">
                            <div class="app-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <circle cx="12" cy="12" r="10" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                                Security Terminal - v2.4.0
                            </div>
                            <div class="app-controls">
                                <div class="control-btn" onclick="minimizeApp('security')">_</div>
                                <div class="control-btn close" onclick="closeApp('security')">×</div>
                            </div>
                        </div>

                        <!-- Content adapted from original monitor structure -->
                        <div style="flex:1; display:flex; flex-direction:column; overflow:hidden">
                            <!-- Header -->
                            <div class="monitor-header">
                                <div class="header-title">LIVE FEED</div>
                                <div class="header-hint">[DBL-CLICK TO REPORT ANOMALY]</div>
                                <div class="header-info">
                                    <span id="clock" style="width: 70px">00:00:00</span>
                                    <span style="color:var(--green-bright)">SIGNAL: STRONG</span>
                                </div>
                            </div>

                            <!-- Main Camera View -->
                            <div class="monitor-viewport" id="monitor-viewport">
                                <img src="background6.png" alt="Camera Feed" class="camera-feed" id="main-feed">

                                <div class="camera-overlay">
                                    <div class="cam-tag-tl">
                                        <span class="cam-id" id="cam-id-display">CAM-05</span>
                                        <span class="cam-loc" id="cam-name-display">LOBBY ENTRY</span>
                                    </div>
                                    <div class="cam-tag-tr">
                                        <div class="rec-badge">
                                            <div class="rec-dot"></div> REC
                                        </div>
                                    </div>
                                    <div class="cam-tag-bl">
                                        <span>ISO 800</span>
                                        <span>F/2.4</span>
                                        <span>1/60</span>
                                    </div>
                                </div>

                                <div class="multifeed-view" id="multifeed-view">
                                    <div class="multi-feed-badge">MULTI-FEED GREEN</div>
                                    <div class="multifeed-grid" id="multifeed-grid"></div>
                                </div>

                                <!-- ═══ ANOMALY REPORT OVERLAY ═══ -->
                                <div class="overlay" id="overlay-anomaly">
                                    <div class="context-menu">
                                        <div class="context-header">
                                            <span class="context-header-text">What'd you see?</span>
                                        </div>
                                        <div class="context-item" onclick="submitAnomalyReport('Extra Object')">
                                            <span class="ctx-icon"><svg width="20" height="20" viewBox="0 0 20 20"
                                                    fill="none">
                                                    <path d="M3 7l7-4 7 4v10H3z" />
                                                    <path d="M10 3v14" opacity="0.45" />
                                                    <path d="M3 11h14" opacity="0.45" />
                                                </svg></span>
                                            <span class="ctx-label">Extra Object</span>
                                            <span class="ctx-key">1</span>
                                        </div>
                                        <div class="context-item" onclick="submitAnomalyReport('Something Missing')">
                                            <span class="ctx-icon"><svg width="20" height="20" viewBox="0 0 20 20"
                                                    fill="none">
                                                    <circle cx="10" cy="10" r="7" stroke-dasharray="3 3" />
                                                    <path d="M10 6v4" />
                                                    <circle class="fill-current" cx="10" cy="13.6" r="1" />
                                                </svg></span>
                                            <span class="ctx-label">Something Missing</span>
                                            <span class="ctx-key">2</span>
                                        </div>
                                        <div class="context-item" onclick="submitAnomalyReport('Something Changed')">
                                            <span class="ctx-icon"><svg width="20" height="20" viewBox="0 0 20 20"
                                                    fill="none">
                                                    <path d="M14.5 6.5a5 5 0 01-8 4" />
                                                    <path d="M5.5 13.5a5 5 0 018-4" />
                                                    <path d="M14.5 6.5l-2.3 0.6 0.7-2.2" class="fill-current" />
                                                    <path d="M5.5 13.5l2.3-0.6-0.7 2.2" class="fill-current" />
                                                </svg></span>
                                            <span class="ctx-label">Something Changed</span>
                                            <span class="ctx-key">3</span>
                                        </div>
                                        <div class="context-item" onclick="submitAnomalyReport('Moved Object')">
                                            <span class="ctx-icon"><svg width="20" height="20" viewBox="0 0 20 20"
                                                    fill="none">
                                                    <rect x="3" y="7" width="5" height="6" rx="1" />
                                                    <path d="M8.8 10h7" />
                                                    <path d="M13.5 7.4L16.2 10l-2.7 2.6" />
                                                </svg></span>
                                            <span class="ctx-label">Moved Object</span>
                                            <span class="ctx-key">4</span>
                                        </div>
                                        <div class="context-item" onclick="submitAnomalyReport('Intruder!')">
                                            <span class="ctx-icon"><svg width="20" height="20" viewBox="0 0 20 20"
                                                    fill="none">
                                                    <circle cx="10" cy="5" r="2.4" />
                                                    <path d="M10 8v5" />
                                                    <path d="M6.3 10.8L10 13l3.7-2.2" />
                                                    <path d="M7 17.2l3-4.4 3 4.4" />
                                                </svg></span>
                                            <span class="ctx-label">Intruder!</span>
                                            <span class="ctx-key">5</span>
                                        </div>
                                        <div class="context-item" onclick="submitAnomalyReport('Camera Glitch')">
                                            <span class="ctx-icon"><svg width="20" height="20" viewBox="0 0 20 20"
                                                    fill="none">
                                                    <rect x="2.5" y="6" width="15" height="11" rx="1.5" />
                                                    <path d="M6.5 6l1.6-2.6h3.8L13.5 6" />
                                                    <circle cx="10" cy="11.4" r="3.2" />
                                                    <path d="M6.7 12.6l2-2 1.8 1.8 2.7-2.7" opacity="0.55" />
                                                </svg></span>
                                            <span class="ctx-label">Camera Glitch</span>
                                            <span class="ctx-key">6</span>
                                        </div>
                                        <div class="context-item" onclick="submitAnomalyReport('Weird Text')">
                                            <span class="ctx-icon"><svg width="20" height="20" viewBox="0 0 20 20"
                                                    fill="none"><path d="M3 15h11" opacity="0.35" />
                                                    <text x="3" y="14" font-family="Rajdhani, sans-serif"
                                                        font-size="11" font-weight="700" fill="currentColor"
                                                        transform="rotate(-4 10 10)">A?</text>
                                                    <path d="M14 5.2l2.8 1.7-0.9 3.5" opacity="0.55" />
                                                </svg></span>
                                            <span class="ctx-label">Weird Text</span>
                                            <span class="ctx-key">7</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Footer Controls -->
                            <div class="monitor-footer">
                                <!-- Stress Indicator -->
                                <div class="stress-monitor" id="stress-monitor">
                                    <div class="stress-icon" id="stress-icon">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                            stroke-linejoin="round">
                                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                        </svg>
                                    </div>
                                    <div class="stress-info">
                                        <div class="stress-header">
                                            <span class="stress-label">Stress</span>
                                            <span class="stress-value" id="stress-value-display">35%</span>
                                        </div>
                                        <div class="stress-track">
                                            <div class="stress-fill" id="stress-fill-bar"></div>
                                        </div>
                                    </div>
                                </div>

                                <button class="btn cam-btn" onclick="switchCam(0)">CAM-01</button>
                                <button class="btn cam-btn" onclick="switchCam(1)">CAM-02</button>
                                <button class="btn cam-btn" onclick="switchCam(2)">CAM-03</button>
                                <button class="btn cam-btn" onclick="switchCam(3)">CAM-04</button>
                                <button class="btn cam-btn active" onclick="switchCam(4)">CAM-05</button>
                                <button class="btn btn-layout" id="back-to-multi-btn" onclick="setLayoutMode(true)"
                                    style="display:none;">BACK TO MULTI-FEED</button>
                                <button class="btn btn-layout" id="layout-toggle-btn" onclick="toggleLayoutMode()">MULTI-FEED</button>

                                <!-- Payslip Display -->
                                <div class="footer-pay" id="footer-pay">
                                    <span class="footer-pay-label">Shift Payslip</span>
                                    <span class="footer-pay-value" id="cam-pay-display">$847</span>
                                </div>

                                <div class="pills-action" id="pills-btn" onclick="usePills()">
                                    <div class="pill-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                            <rect x="7" y="3" width="10" height="18" rx="5" stroke="currentColor"
                                                stroke-width="2" transform="rotate(45 12 12)" fill="var(--green)"
                                                fill-opacity="0.2" />
                                            <line x1="8.5" y1="8.5" x2="15.5" y2="15.5" stroke="currentColor"
                                                stroke-width="2" />
                                        </svg>
                                    </div>
                                    <div class="pill-info">
                                        <span class="pill-label">Sanity Pills</span>
                                        <span class="pill-count" id="pill-counter">x3</span>
                                    </div>
                                    <span class="pill-hotkey">Q</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ─── INCIDENT LOGS APP WINDOW ─── -->
                    <div class="app-window" id="logs-app"
                        style="display:none; width:400px; height:500px; top:10%; left:10%; right:auto; bottom:auto; box-shadow: 0 20px 50px rgba(0,0,0,0.8);">
                        <div class="app-header-bar">
                            <div class="app-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" />
                                    <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" />
                                </svg>
                                Incident Observer - Log Viewer
                            </div>
                            <div class="app-controls">
                                <div class="control-btn" onclick="minimizeApp('logs')">_</div>
                                <div class="control-btn close" onclick="closeApp('logs')">×</div>
                            </div>
                        </div>
                        <div class="logs-container" id="logs-list-content">
                            <!-- Logs injected here -->
                            <div
                                style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; opacity:0.3;">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="1">
                                    <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                                <span style="font-family:var(--font-ui); font-size:12px; margin-top:12px;">No
                                    incidents reported yet.</span>
                            </div>
                        </div>
                    </div>

                    <!-- ─── INBOX APP WINDOW ─── -->
                    <div class="app-window" id="inbox-app"
                        style="display:none; width:600px; height:450px; top:15%; left:20%; right:auto; bottom:auto; box-shadow: 0 25px 60px rgba(0,0,0,0.9);">
                        <div class="app-header-bar">
                            <div class="app-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <rect x="2" y="4" width="20" height="16" rx="2" />
                                    <path d="M22 6l-10 7L2 6" />
                                </svg>
                                WOOD Mail - Connected
                            </div>
                            <div class="app-controls">
                                <div class="control-btn" onclick="minimizeApp('inbox')">_</div>
                                <div class="control-btn close" onclick="closeApp('inbox')">×</div>
                            </div>
                        </div>
                        <div class="inbox-layout">
                            <div class="inbox-sidebar" id="inbox-list">
                                <!-- Messages list -->
                            </div>
                            <div class="inbox-main" id="email-content">
                                <!-- Email content -->
                                <div
                                    style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; opacity:0.2;">
                                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="1">
                                        <rect x="2" y="4" width="20" height="16" rx="2" />
                                        <path d="M22 6l-10 7L2 6" />
                                    </svg>
                                    <span style="font-family:var(--font-ui); font-size:14px; margin-top:16px;">Select a
                                        message to read</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ─── MANAGEMENT APP WINDOW ─── -->
                    <div class="app-window" id="manager-app"
                        style="display:none; width:520px; height:600px; top:5%; left:30%; right:auto; bottom:auto; box-shadow: 0 30px 80px rgba(0,0,0,0.95);">
                        <div class="app-header-bar">
                            <div class="app-title">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <line x1="18" y1="20" x2="18" y2="10" />
                                    <line x1="12" y1="20" x2="12" y2="4" />
                                    <line x1="6" y1="20" x2="6" y2="14" />
                                </svg>
                                Management Console - Shift Observer v1.2
                            </div>
                            <div class="app-controls">
                                <div class="control-btn" onclick="minimizeApp('manager')">_</div>
                                <div class="control-btn close" onclick="closeApp('manager')">×</div>
                            </div>
                        </div>
                        <div class="management-layout">
                            <!-- Top Stats Grid -->
                            <div class="mgmt-grid">
                                <div class="mgmt-card">
                                    <div class="mgmt-card-title">Payslip</div>
                                    <div class="mgmt-value money" id="mgmt-pay-display">$847</div>
                                    <div style="font-size:10px; color:var(--text-mid);">Deductions: -$320 | Bonuses:
                                        +$667</div>
                                </div>
                                <div class="mgmt-card">
                                    <div class="mgmt-card-title">Performance Rating</div>
                                    <div class="mgmt-value warn">B-</div>
                                    <div style="font-size:10px; color:var(--text-mid);">Threshold: $500 (STABLE)</div>
                                </div>
                            </div>

                            <!-- Middle Section: Active Breakdowns -->
                            <div class="mgmt-card" style="flex:1;">
                                <div class="mgmt-card-title">System Breakdown Log (Active)</div>
                                <div class="mgmt-list" id="active-breakdowns">
                                    <div class="mgmt-list-item breakdown">
                                        <div style="display:flex; flex-direction:column;">
                                            <span style="font-weight:700; color:var(--text-bright);">Pipe Clog -
                                                Basement</span>
                                            <span style="font-size:10px; color:var(--text-mid);">Pay Drain: -$2 /
                                                sec</span>
                                        </div>
                                        <div class="mgmt-status-tag active">CRITICAL</div>
                                    </div>
                                    <div class="mgmt-list-item breakdown">
                                        <div style="display:flex; flex-direction:column;">
                                            <span style="font-weight:700; color:var(--text-bright);">Loose Bolts - VIP
                                                Office</span>
                                            <span style="font-size:10px; color:var(--text-mid);">Pay Drain: -$1 /
                                                sec</span>
                                        </div>
                                        <div class="mgmt-status-tag active">STALLING</div>
                                    </div>
                                    <div style="margin-top:auto; text-align:center; padding:20px; opacity:0.2;">
                                        <span style="font-family:var(--font-mono); font-size:10px;">End of active
                                            logs</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Bottom Section: Anomalies -->
                            <div class="mgmt-card">
                                <div class="mgmt-card-title">Anomaly Reports Overview</div>
                                <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                                    <div style="display:flex; gap:20px;">
                                        <div>
                                            <div
                                                style="font-size:22px; font-family:var(--font-display); color:var(--text-bright);">
                                                12</div>
                                            <div style="font-size:9px; color:var(--text-mid); font-weight:700;">RESOLVED
                                            </div>
                                        </div>
                                        <div>
                                            <div
                                                style="font-size:22px; font-family:var(--font-display); color:var(--red-bright);">
                                                02</div>
                                            <div style="font-size:9px; color:var(--text-mid); font-weight:700;">FALSE
                                                ALERTS</div>
                                        </div>
                                    </div>
                                    <div style="text-align:right;">
                                        <div
                                            style="font-size:14px; font-family:var(--font-mono); color:var(--green-bright);">
                                            SIGNAL: 98%</div>
                                        <div style="font-size:9px; color:var(--text-dim);">SYNC STATUS</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ─── SYSTEM DIALOG ─── -->
                    <div id="system-dialog">
                        <div class="dialog-box">
                            <div class="dialog-header">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2.5">
                                    <path
                                        d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" />
                                    <line x1="12" y1="9" x2="12" y2="13" />
                                    <line x1="12" y1="17" x2="12.01" y2="17" />
                                </svg>
                                <span class="dialog-title" id="dialog-title">System Message</span>
                            </div>
                            <div class="dialog-body">
                                <p class="dialog-msg" id="dialog-msg">Device operation completed successfully.</p>
                            </div>
                            <div class="dialog-footer">
                                <button class="dialog-btn" onclick="hideSystemDialog()">OK</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Camera Config
            const cams = {
                0: {
                    id: 'CAM-01',
                    views: [{
                        name: 'WAITING ROOM 2',
                        src: 'background2.png'
                    }, {
                        name: 'FOOD COURT',
                        src: 'background 11.png'
                    }, {
                        name: 'PARKING LOT',
                        src: 'background 12.png'
                    }]
                },
                1: {
                    id: 'CAM-02',
                    views: [{
                        name: 'CLOTHES SHOP',
                        src: 'background3.png'
                    }, {
                        name: 'PARKING LOT 2',
                        src: 'background 13.png'
                    }, {
                        name: 'CINEMA',
                        src: 'background14.png'
                    }]
                },
                2: {
                    id: 'CAM-03',
                    views: [{
                        name: 'VIP OFFICE',
                        src: 'background4.png'
                    }, {
                        name: 'SECURITY ROOM',
                        src: 'background7.png'
                    }, {
                        name: 'ARCADE ZONE',
                        src: 'background10.png'
                    }]
                },
                3: {
                    id: 'CAM-04',
                    views: [{
                        name: 'UTILITY ROOM',
                        src: 'background5.png'
                    }, {
                        name: 'BATHROOM A',
                        src: 'background8.png'
                    }, {
                        name: 'POOL AREA',
                        src: 'background9.png'
                    }]
                },
                4: {
                    id: 'CAM-05',
                    views: [{
                        name: 'LOBBY DESK',
                        src: 'background6.png'
                    }, {
                        name: 'LOBBY ENTRY',
                        src: 'background.png'
                    }, {
                        name: 'FOOD COURT',
                        src: 'background 11.png'
                    }]
                }
            };

            // Track current index for each cam
            // Initialize random index for each cam ON LOAD
            const camIndices = {};
            for (let i = 0; i < 5; i++) {
                camIndices[i] = Math.floor(Math.random() * cams[i].views.length);
            }

            let currentCamId = 'CAM-05';
            const incidentLogs = [];
            let reportTimeout = null;
            let currentPay = 847;
            let isMultiLayout = false;
            let focusedFromMultiFeed = false;

            function updatePay(amount = 0) {
                currentPay += amount;

                // Show floating feedback if amount changed
                if (amount !== 0) {
                    const payContainer = document.getElementById('footer-pay');
                    if (payContainer) {
                        const floatEl = document.createElement('div');
                        floatEl.className = 'pay-float ' + (amount > 0 ? 'plus' : 'minus');
                        floatEl.textContent = (amount > 0 ? '+' : '') + '$' + Math.abs(amount);
                        payContainer.appendChild(floatEl);

                        // Cleanup after animation
                        setTimeout(() => floatEl.remove(), 1200);
                    }
                }

                const formattedPay = '$' + currentPay.toLocaleString('en-US', {
                    minimumIntegerDigits: 3,
                    useGrouping: true
                }).replace(',', ','); // Keep the comma if needed or just use toLocaleString

                // Format specifically matching user request: $847 (no leading zero)
                const displayPay = '$' + currentPay.toLocaleString('en-US');

                const mgmtDisplay = document.getElementById('mgmt-pay-display');
                const camDisplay = document.getElementById('cam-pay-display');

                if (mgmtDisplay) mgmtDisplay.textContent = displayPay;
                if (camDisplay) camDisplay.textContent = displayPay;
            }

            // Store original menu content for restoration
            const originalAnomalyMenu = document.querySelector('#overlay-anomaly .context-menu').innerHTML;

            function renderMultiFeedTiles() {
                const grid = document.getElementById('multifeed-grid');
                if (!grid) return;

                const cameraTiles = Object.keys(cams).map((camKey) => {
                    const idx = parseInt(camKey, 10);
                    const cam = cams[idx];
                    const view = cam.views[camIndices[idx]];
                    return `
                        <button class="multi-tile" onclick="focusFromMultiFeed(${idx})" title="Open ${cam.id}">
                            <img src="${view.src}" alt="${cam.id} ${view.name}">
                            <div class="multi-tile-meta">
                                <span>${cam.id}</span>
                                <span>${view.name}</span>
                            </div>
                        </button>
                    `;
                }).join('');

                const signalTile = `
                    <div class="multi-tile static-channel" title="Signal map channel">
                        <div class="multi-tile-static-grid"></div>
                        <div class="static-channel-label">SIG-MAP / CHANNEL-06</div>
                        <div class="multi-tile-meta">
                            <span>GRID LINK</span>
                            <span>STABLE 98%</span>
                        </div>
                    </div>
                `;

                grid.innerHTML = cameraTiles + signalTile;
            }

            function updateLayoutControls() {
                const camBtns = document.querySelectorAll('.monitor-footer .cam-btn');
                const backBtn = document.getElementById('back-to-multi-btn');
                const layoutBtn = document.getElementById('layout-toggle-btn');

                const showCamButtons = !isMultiLayout && !focusedFromMultiFeed;
                const showBackButton = !isMultiLayout && focusedFromMultiFeed;

                camBtns.forEach((btn) => {
                    btn.style.display = showCamButtons ? '' : 'none';
                });

                if (backBtn) {
                    backBtn.style.display = showBackButton ? '' : 'none';
                }

                if (layoutBtn) {
                    layoutBtn.style.display = showBackButton ? 'none' : '';
                }
            }

            function setLayoutMode(enableMulti) {
                isMultiLayout = enableMulti;

                const viewport = document.getElementById('monitor-viewport');
                const layoutBtn = document.getElementById('layout-toggle-btn');
                const headerHint = document.querySelector('.header-hint');

                viewport.classList.toggle('multi-layout', enableMulti);
                layoutBtn.classList.toggle('layout-active', enableMulti);
                layoutBtn.textContent = enableMulti ? 'SINGLE VIEW' : 'MULTI-FEED';
                headerHint.textContent = enableMulti ? '[CLICK A FEED TO FOCUS CAMERA]' : '[DBL-CLICK TO REPORT ANOMALY]';

                if (enableMulti) {
                    focusedFromMultiFeed = false;
                }

                if (enableMulti) {
                    if (reportTimeout) {
                        clearTimeout(reportTimeout);
                        reportTimeout = null;
                    }
                    const anomalyOverlay = document.getElementById('overlay-anomaly');
                    anomalyOverlay.classList.remove('active');
                    renderMultiFeedTiles();
                }

                updateLayoutControls();
            }

            function toggleLayoutMode() {
                setLayoutMode(!isMultiLayout);
            }

            function focusFromMultiFeed(idx) {
                focusedFromMultiFeed = true;
                switchCam(idx);
            }

            function switchCam(idx) {
                if (isMultiLayout) {
                    setLayoutMode(false);
                }

                // Update active button
                const btns = document.querySelectorAll('.monitor-footer .cam-btn');
                btns.forEach(b => b.classList.remove('active'));
                if (btns[idx]) btns[idx].classList.add('active');

                const cam = cams[idx];
                currentCamId = cam.id;
                // Use the pre-selected random index (stable for this session)
                const view = cam.views[camIndices[idx]];

                // Update info
                document.getElementById('cam-id-display').textContent = cam.id;
                document.getElementById('cam-name-display').textContent = view.name;

                // Update Image
                const img = document.getElementById('main-feed');
                img.style.opacity = 0.5;
                setTimeout(() => {
                    img.src = view.src;
                    img.onload = () => {
                        img.style.opacity = 0.8;
                    };
                }, 100);

                if (isMultiLayout) {
                    renderMultiFeedTiles();
                }

                if (!isMultiLayout) {
                    updateLayoutControls();
                }
            }

            // Clock
            function updateClock() {
                const now = new Date();
                document.getElementById('clock').textContent = now.toLocaleTimeString('en-GB', {
                    hour12: false
                });
            }
            setInterval(updateClock, 1000);

            // Initialize default view
            updateClock();

            // ─── DESKTOP LOGIC ───

            function openApp(appId) {
                if (appId === 'security') {
                    document.getElementById('security-app').style.display = 'flex';
                    updateTaskbar('security', 'Security.exe', true, `
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/>
                            </svg>
                        `);
                } else if (appId === 'logs') {
                    document.getElementById('logs-app').style.display = 'flex';
                    renderLogs();
                    updateTaskbar('logs', 'Logs.exe', true, `
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
                            </svg>
                        `);
                } else if (appId === 'inbox') {
                    document.getElementById('inbox-app').style.display = 'flex';
                    renderInbox();
                    updateTaskbar('inbox', 'Inbox', true, `
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="4" width="20" height="16" rx="2" /><path d="M22 6l-10 7L2 6" />
                            </svg>
                        `);
                } else if (appId === 'manager') {
                    document.getElementById('manager-app').style.display = 'flex';
                    updateTaskbar('manager', 'Management.sys', true, `
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>
                            </svg>
                        `);
                }
            }

            function closeApp(appId) {
                document.getElementById(appId + '-app').style.display = 'none';
                updateTaskbar(appId, null, false);
            }

            function minimizeApp(appId) {
                document.getElementById(appId + '-app').style.display = 'none';
                let label = 'Security.exe';
                let svg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>`;

                if (appId === 'logs') {
                    label = 'Logs.exe';
                    svg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>`;
                } else if (appId === 'inbox') {
                    label = 'Inbox';
                    svg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2" /><path d="M22 6l-10 7L2 6" /></svg>`;
                } else if (appId === 'manager') {
                    label = 'Management.sys';
                    svg = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>`;
                }

                updateTaskbar(appId, label, false, svg);
            }

            function updateTaskbar(id, label, active, iconSvg) {
                const container = document.getElementById('taskbar-items');
                let item = document.getElementById('task-' + id);

                if (!label) {
                    if (item) item.remove();
                    return;
                }

                if (!item) {
                    item = document.createElement('div');
                    item.id = 'task-' + id;
                    item.className = 'task-item';
                    item.onclick = () => openApp(id);
                    item.innerHTML = `
                            <div class="task-item-icon">${iconSvg}</div>
                            <span>${label}</span>
                        `;
                    container.appendChild(item);
                }

                item.classList.toggle('active', active);
            }

            function submitAnomalyReport(type) {
                const camName = document.getElementById('cam-name-display').textContent;
                const time = document.getElementById('clock').textContent;
                const isSuccess = Math.random() > 0.6; // 40% success rate for demo (more frequent failures)

                incidentLogs.unshift({
                    id: 'INC-' + Math.floor(Math.random() * 10000).toString().padStart(4, '0'),
                    type: type,
                    cam: currentCamId,
                    location: camName,
                    time: time,
                    status: isSuccess ? 'FIXED' : 'REJECTED'
                });

                const newLog = incidentLogs[0];

                // Trigger camera glitch
                const feed = document.getElementById('main-feed');
                feed.classList.remove('report-glitch-active');
                void feed.offsetWidth; // trigger reflow
                feed.classList.add('report-glitch-active');
                setTimeout(() => feed.classList.remove('report-glitch-active'), 800);

                // Visual feedback
                const menu = document.querySelector('#overlay-anomaly .context-menu');
                const originalContent = menu.innerHTML;

                if (isSuccess) {
                    if (typeof successSound !== 'undefined') {
                        successSound.currentTime = 0;
                        successSound.play();
                    }
                    menu.innerHTML = `
                        <div class="report-confirm">
                            <div class="scan-flash"></div>
                            <svg class="confirm-icon" viewBox="0 0 52 52">
                                <circle class="ring" cx="26" cy="26" r="25" fill="none"
                                    stroke="var(--green-bright)" stroke-width="1.5" />
                                <path class="check" d="M15 27l7 7 15-15" fill="none"
                                    stroke="var(--green-bright)" stroke-width="2.5"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <div class="confirm-title">REPORT FILED</div>
                            <div class="confirm-id">${newLog.id} — ${type}</div>
                            <div class="confirm-sub">${currentCamId} · ${camName}</div>
                            <div class="confirm-bar-track"><div class="confirm-bar-fill"></div></div>
                        </div>
                    `;
                    // Reward for correct report
                    updatePay(50);
                } else {
                    // Failure Case
                    if (typeof failedSound !== 'undefined') {
                        failedSound.currentTime = 0;
                        failedSound.play();
                    }
                    menu.innerHTML = `
                        <div class="report-fail">
                            <div class="scan-flash"></div>
                            <svg class="fail-icon" viewBox="0 0 52 52">
                                <circle class="ring" cx="26" cy="26" r="25" fill="none"
                                    stroke-width="1.5" />
                                <path class="cross" d="M18 18l16 16M34 18l-16 16" fill="none"
                                    stroke-width="2.5"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <div class="fail-title">REPORT REJECTED</div>
                            <div class="confirm-id">${newLog.id} — INVALID</div>
                            <div class="confirm-sub" style="color:var(--red-bright)">FALSE ALARM DETECTED</div>
                            <div class="confirm-bar-track"><div class="fail-bar-fill"></div></div>
                        </div>
                    `;
                    // Increase stress on failure
                    updateStress(15);
                    // Penalty for false report
                    updatePay(-25);
                }

                // Clear any existing timeout to prevent "ghost" closures
                if (reportTimeout) clearTimeout(reportTimeout);

                reportTimeout = setTimeout(() => {
                    // Check if the overlay is still active before auto-closing
                    if (anomalyOverlay.classList.contains('active')) {
                        anomalyOverlay.classList.remove('active');
                    }
                    setTimeout(() => {
                        menu.innerHTML = originalAnomalyMenu;
                        if (document.getElementById('logs-app').style.display !== 'none') {
                            renderLogs();
                        }
                    }, 300);
                    reportTimeout = null;
                }, 5000);
            }

            function toggleLogStatus(logId) {
                const log = incidentLogs.find(l => l.id === logId);
                if (log) {
                    log.status = log.status === 'FIXED' ? 'PENDING' : 'FIXED';
                    renderLogs();
                }
            }

            function renderLogs() {
                const list = document.getElementById('logs-list-content');
                if (!list) return;

                if (incidentLogs.length === 0) {
                    list.innerHTML = `
                        <div style="height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; opacity:0.3;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                            <span style="font-family:var(--font-ui); font-size:12px; margin-top:12px;">No incidents reported yet.</span>
                        </div>
                    `;
                    return;
                }

                list.innerHTML = incidentLogs.map(log => {
                    let statusClass = '';
                    if (log.status === 'FIXED') statusClass = 'resolved';
                    else if (log.status === 'REJECTED') statusClass = 'rejected';

                    return `
                        <div class="log-entry ${statusClass}">
                            <div class="log-time">${log.time}</div>
                            <div class="log-content">
                                <div class="log-header">
                                    <span>${log.id} - ${log.type}</span>
                                    <span class="log-status ${log.status.toLowerCase()}">${log.status}</span>
                                </div>
                                <div class="log-desc">Detected on ${log.cam} (${log.location})</div>
                                ${log.status !== 'REJECTED' ? `
                                <button class="btn-tiny" onclick="toggleLogStatus('${log.id}')" style="margin-top:8px; font-size:10px; padding:2px 8px; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); color:var(--text-mid); cursor:pointer; border-radius:2px;">
                                    Mark as ${log.status === 'FIXED' ? 'Pending' : 'Fixed'}
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Shortcut Single Click Selection
            document.querySelectorAll('.desktop-shortcut').forEach(s => {
                s.addEventListener('click', (e) => {
                    e.stopPropagation();
                    document.querySelectorAll('.desktop-shortcut').forEach(other => other.classList.remove('active'));
                    s.classList.add('active');
                });
            });

            document.getElementById('desktop-view').addEventListener('click', () => {
                document.querySelectorAll('.desktop-shortcut').forEach(s => s.classList.remove('active'));
                document.getElementById('start-menu').classList.remove('active');
            });

            // Taskbar Clock
            function updateTaskbarClock() {
                const now = new Date();
                const h = String(now.getHours()).padStart(2, '0');
                const m = String(now.getMinutes()).padStart(2, '0');
                document.getElementById('taskbar-clock').textContent = h + ':' + m;
            }
            setInterval(updateTaskbarClock, 1000);
            updateTaskbarClock();

            // Initialize default view to apply random selection
            switchCam(4);

            // Anomaly Modal Interaction
            const anomalyOverlay = document.getElementById('overlay-anomaly');
            const monitorViewport = document.getElementById('monitor-viewport');

            monitorViewport.addEventListener('dblclick', function (e) {
                if (isMultiLayout) return;

                // Get viewport bounds
                const rect = monitorViewport.getBoundingClientRect();

                // Calculate coords relative to viewport
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // Always restore original menu content before opening
                const menu = anomalyOverlay.querySelector('.context-menu');
                if (menu) menu.innerHTML = originalAnomalyMenu;

                // Activate first to render and measure
                anomalyOverlay.classList.add('active');

                // Position menu intelligently
                if (menu) {
                    const menuWidth = menu.offsetWidth;
                    const menuHeight = menu.offsetHeight;

                    let safeX = x + 15; // Primary: Right of cursor
                    let safeY = y;

                    // Flip to left if it hits the right edge
                    if (safeX + menuWidth > rect.width) {
                        safeX = x - menuWidth - 15;
                    }

                    // Push up if it hits the bottom edge
                    if (safeY + menuHeight > rect.height) {
                        safeY = rect.height - menuHeight - 10; // 10px breathing room
                    }

                    // Ensure it doesn't go off the top/left either
                    safeX = Math.max(10, safeX);
                    safeY = Math.max(10, safeY);

                    menu.style.left = safeX + 'px';
                    menu.style.top = safeY + 'px';
                }
            });

            // Close on Esc
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    // 1. Close system dialog if open
                    const systemDialog = document.getElementById('system-dialog');
                    if (systemDialog && systemDialog.style.display === 'flex') {
                        hideSystemDialog();
                        return;
                    }

                    // 2. Close start menu if active
                    const startMenu = document.getElementById('start-menu');
                    if (startMenu && startMenu.classList.contains('active')) {
                        startMenu.classList.remove('active');
                        return;
                    }

                    // 3. Close anomaly reporting overlay
                    if (anomalyOverlay && anomalyOverlay.classList.contains('active')) {
                        if (reportTimeout) {
                            clearTimeout(reportTimeout);
                            reportTimeout = null;
                        }
                        anomalyOverlay.classList.remove('active');
                        const menu = anomalyOverlay.querySelector('.context-menu');
                        if (menu) menu.innerHTML = originalAnomalyMenu;
                        return;
                    }

                    // 4. Close opened app windows (one by one, highest z-index first)
                    const apps = ['security', 'logs', 'inbox', 'manager'];
                    const visibleApps = apps.filter(id => {
                        const el = document.getElementById(id + '-app');
                        return el && el.style.display !== 'none';
                    });

                    if (visibleApps.length > 0) {
                        // Sort by z-index to close the "top" window first
                        const topAppId = visibleApps.sort((a, b) => {
                            const zA = parseInt(window.getComputedStyle(document.getElementById(a + '-app')).zIndex) || 0;
                            const zB = parseInt(window.getComputedStyle(document.getElementById(b + '-app')).zIndex) || 0;
                            return zB - zA;
                        })[0];

                        closeApp(topAppId);
                        return;
                    }

                    // 5. If everything else is closed, logout
                    logout();
                }
            });

            // Close on click outside (clicked on overlay background)
            anomalyOverlay.addEventListener('click', (e) => {
                if (e.target === anomalyOverlay) {
                    if (reportTimeout) {
                        clearTimeout(reportTimeout);
                        reportTimeout = null;
                    }
                    anomalyOverlay.classList.remove('active');
                    // Immediately restore menu if closed manually
                    const menu = anomalyOverlay.querySelector('.context-menu');
                    if (menu) menu.innerHTML = originalAnomalyMenu;
                }
            });

            // ─── STRESS & PILLS MECHANIC ───
            let currentStress = 35;
            let pillCount = 3;

            function updateStress(amount) {
                currentStress += amount;
                if (currentStress > 100) currentStress = 100;
                if (currentStress < 0) currentStress = 0;

                const stressFill = document.getElementById('stress-fill-bar');
                const stressValue = document.getElementById('stress-value-display');
                const stressMonitor = document.getElementById('stress-monitor');
                const stressIcon = document.getElementById('stress-icon');

                if (stressFill && stressValue) {
                    stressFill.style.width = currentStress + '%';
                    stressValue.textContent = Math.floor(currentStress) + '%';

                    // Update color and animations based on stress level
                    if (currentStress >= 80) {
                        stressValue.style.color = 'var(--red-bright)';
                        stressIcon.style.color = 'var(--red-bright)';
                        stressMonitor.classList.add('high-stress');
                    } else if (currentStress >= 50) {
                        stressValue.style.color = 'var(--yellow)';
                        stressIcon.style.color = 'var(--yellow)';
                        stressMonitor.classList.remove('high-stress');
                    } else {
                        stressValue.style.color = 'var(--green-bright)';
                        stressIcon.style.color = 'var(--green-bright)';
                        stressMonitor.classList.remove('high-stress');
                    }
                }
            }

            // Initialize
            updateStress(0);

            // Gradually increase stress over time if security app is open
            setInterval(() => {
                if (document.getElementById('security-app').style.display !== 'none') {
                    updateStress(0.5); // Slowly build stress
                }
            }, 1000);

            function usePills() {
                if (pillCount <= 0) return;

                pillCount--;
                document.getElementById('pill-counter').textContent = 'x' + pillCount;

                // Greatly reduce stress
                updateStress(-40);

                // Add physical feedback to button
                const pillBtn = document.getElementById('pills-btn');
                pillBtn.style.transform = 'scale(0.95)';
                setTimeout(() => pillBtn.style.transform = '', 100);

                // Play glitch effect on feed
                const feed = document.getElementById('main-feed');
                feed.classList.remove('hallucination-cleared');
                void feed.offsetWidth; // trigger reflow
                feed.classList.add('hallucination-cleared');

                // If empty, disable button visually
                if (pillCount <= 0) {
                    pillBtn.style.opacity = '0.5';
                    pillBtn.style.filter = 'grayscale(1)';
                    pillBtn.style.cursor = 'not-allowed';
                    pillBtn.style.pointerEvents = 'none';
                }
            }

            // Hotkeys: Camera Switching (1-5), Anomaly Reporting (1-7), and Pills (Q)
            document.addEventListener('keydown', (e) => {
                const securityApp = document.getElementById('security-app');
                if (securityApp.style.display === 'none') return;

                const key = e.key;

                // 1. Anomaly Report Hotkeys (Active when menu is open)
                if (anomalyOverlay.classList.contains('active')) {
                    const reportMap = {
                        '1': 'Extra Object',
                        '2': 'Something Missing',
                        '3': 'Something Changed',
                        '4': 'Moved Object',
                        '5': 'Intruder!',
                        '6': 'Camera Glitch',
                        '7': 'Weird Text'
                    };
                    if (reportMap[key]) {
                        submitAnomalyReport(reportMap[key]);
                        e.preventDefault();
                        return;
                    }
                }

                // 2. Camera Switching Hotkeys (1-5)
                if (key >= '1' && key <= '5') {
                    switchCam(parseInt(key) - 1);
                    return;
                }

                // 3. Pill Usage (Q)
                if (key.toLowerCase() === 'q') {
                    usePills();
                }
            });

            // Window Dragging Logic
            function makeDraggable(el) {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                const header = el.querySelector('.app-header-bar');
                if (header) {
                    header.style.cursor = 'grab';
                    header.onmousedown = dragMouseDown;
                }

                function dragMouseDown(e) {
                    if (e.target.closest('.app-controls')) return;
                    el.style.zIndex = 20; // Bring to front
                    document.querySelectorAll('.app-window').forEach(w => {
                        if (w !== el) w.style.zIndex = 10;
                    });

                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = closeDragElement;
                    document.onmousemove = elementDrag;
                    header.style.cursor = 'grabbing';
                }

                function elementDrag(e) {
                    e.preventDefault();
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;

                    // Break inset/percentages if any
                    el.style.bottom = 'auto';
                    el.style.right = 'auto';

                    el.style.top = (el.offsetTop - pos2) + "px";
                    el.style.left = (el.offsetLeft - pos1) + "px";
                }

                function closeDragElement() {
                    document.onmouseup = null;
                    document.onmousemove = null;
                    header.style.cursor = 'grab';
                }
            }

            makeDraggable(document.getElementById('logs-app'));
            makeDraggable(document.getElementById('inbox-app'));
            makeDraggable(document.getElementById('manager-app'));

            // ─── INBOX LOGIC ───
            const messages = [{
                id: 1,
                from: "System Admin",
                subject: "Welcome to Wood OS v2.4",
                date: "Today, 08:30",
                unread: true,
                body: "Welcome to your new workstation.\n\nPlease ensure all camera feeds are monitored at all times. Any anomalies should be reported immediately via the Incident Logs system.\n\nGood luck."
            }, {
                id: 2,
                from: "M. Woodman",
                subject: "Night Shift Protocol",
                date: "Yesterday, 22:15",
                unread: false,
                body: "Just a reminder: don't open the basement door. No matter what sounds you hear.\n\nAlso, the coffee machine in the lobby is broken. Use the one in the security room."
            }, {
                id: 3,
                from: "HR Department",
                subject: "Updated Insurance Policy",
                date: "2 Days Ago",
                unread: false,
                body: "We have updated the insurance policy to cover 'unusual occurrences' and 'spontaneous equipment failure'.\n\nPlease sign the digital waiver in your next login session."
            }];

            function renderInbox() {
                const list = document.getElementById('inbox-list');
                list.innerHTML = messages.map(msg => `
                    <div class="msg-item ${msg.unread ? 'unread' : ''}" onclick="showEmail(${msg.id})">
                        <div class="msg-sender">${msg.from}</div>
                        <div class="msg-subject">${msg.subject}</div>
                    </div>
                `).join('');
            }

            function showEmail(id) {
                const msg = messages.find(m => m.id === id);
                if (!msg) return;

                msg.unread = false;
                renderInbox();

                // Mark current item as active
                document.querySelectorAll('.msg-item').forEach((item, idx) => {
                    item.classList.toggle('active', messages[idx].id === id);
                });

                const content = document.getElementById('email-content');
                content.innerHTML = `
                    <div class="email-view-header">
                        <div class="email-subject">${msg.subject}</div>
                        <div class="email-meta">
                            <span>From: <b>${msg.from}</b></span>
                            <span>${msg.date}</span>
                        </div>
                    </div>
                    <div class="email-body">${msg.body}</div>
                `;
            }

            // ─── SYSTEM DIALOG LOGIC ───
            function showSystemDialog(title, msg) {
                const dialog = document.getElementById('system-dialog');
                document.getElementById('dialog-title').textContent = title;
                document.getElementById('dialog-msg').textContent = msg;
                dialog.style.display = 'flex';
                // Close start menu as well 
                document.getElementById('start-menu').classList.remove('active');
            }

            function hideSystemDialog() {
                document.getElementById('system-dialog').style.display = 'none';
            }

            // ─── START MENU LOGIC ───
            function toggleStartMenu(e) {
                e.stopPropagation();
                document.getElementById('start-menu').classList.toggle('active');
            }

            function logout() {
                // Visual effect: Fade to black
                document.body.style.transition = 'opacity 0.5s ease-in-out';
                document.body.style.opacity = '0';
                setTimeout(() => {
                    window.location.href = 'game-screen.html';
                }, 500);
            }

            // ─── AUDIO SYSTEM ───
            const computerHum = new Audio('../audio/computer.wav');
            computerHum.loop = true;
            computerHum.volume = 0.4;

            const successSound = new Audio('../audio/success.mp3');
            successSound.volume = 0.3;

            const failedSound = new Audio('../audio/failed.mp3');
            failedSound.volume = 0.3;

            // Start ambient sound on first interaction (browser requirement)
            const startAudio = () => {
                computerHum.play().catch(e => console.log("Audio autoplay blocked or failed:", e));
                document.removeEventListener('click', startAudio);
                document.removeEventListener('keydown', startAudio);
            };

            document.addEventListener('click', startAudio);
            document.addEventListener('keydown', startAudio);

            // Final Initializations
            updatePay(0);
            updateStress(0);

            // Voice Indicator Logic
            document.addEventListener('DOMContentLoaded', () => {
                const voiceIndicator = document.getElementById('voice-indicator');
                if (voiceIndicator) {
                    const voiceLabel = voiceIndicator.querySelector('.voice-label');
                    window.addEventListener('keydown', (e) => {
                        if (e.repeat) return;
                        const key = e.key.toLowerCase();
                        if (key === 'v') {
                            voiceIndicator.classList.add('speaking', 'local');
                            if (voiceLabel) voiceLabel.textContent = 'Local';
                        } else if (key === 'b') {
                            voiceIndicator.classList.add('speaking', 'radio');
                            if (voiceLabel) voiceLabel.textContent = 'Radio';
                        }
                    });

                    window.addEventListener('keyup', (e) => {
                        const key = e.key.toLowerCase();
                        if (key === 'v') {
                            voiceIndicator.classList.remove('speaking', 'local');
                        } else if (key === 'b') {
                            voiceIndicator.classList.remove('speaking', 'radio');
                        }
                    });
                }
            });
        </script>
    </div>

    <!-- Voice Indicator -->
    <div class="voice-indicator" id="voice-indicator">
        <div class="voice-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
            </svg>
        </div>
        <div class="voice-waves">
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
        </div>
        <span class="voice-label">Local</span>
    </div>
</body>

</html>
